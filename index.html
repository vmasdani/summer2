<html>
  <head>
    <meta charset="UTF-8" />
    <title>Main</title>
    <script src="main.js"></script>
    <link href="css/tailwind.css" rel="stylesheet" />
    <script src="js/idb-keyval.min.js"></script>
  </head>

  <body>
    <div id="myapp"></div>

    <script>
      var app = Elm.Main.init({
        node: document.getElementById("myapp"),
      });

      // Init idb set
      const init = async () => {
        await Promise.all(
          ["boms", "items"].map(async (table) => {
            const tableContents = await idbKeyval.get(table);

            if (tableContents) {
              console.log(table, "found:", tableContents);
            } else {
              console.log(table, "not found. Creating...");
              await idbKeyval.set(table, []);
            }
          })
        );

        app.ports.idbGet.subscribe(async (table) => {
          app.ports.idbRecv.send({
            name: table,
            content: (await idbKeyval.get("boms"))
              ? JSON.stringify(await idbKeyval.get("boms"))
              : null,
          });
        });

        const idbSet = async (table, value) =>
          await idbKeyVal.set(table, value);
      };

      init();
    </script>
  </body>
</html>
